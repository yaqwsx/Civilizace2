{% extends "game/dashboardBase.html" %}

{% load cards %}

{% block title %} Příběh civilizace - Dashboard {% endblock %}

{% block content %}

{% if boardMessages %}
    <h2 class="text-xl my-1">Nové zprávy</h2>

    {% for message in boardMessages %}
        <div class="w-full my-2">
            <div class="bg-white border-orange-400 border-2 rounded shadow p-4">
                <div class="flex flex-row items-center">
                    <div class="flex-grow text-left md:w-full">
                        <p class="font-bold text-xs uppercase text-gray-600 mb-2">
                            {{message.appearDateTime}}</p>
                        <p>
                            {{ message.content | safe }}
                        </p>
                    </div>
                    <div class="flex-none text-left">
                        {%if not user.isOrg %}<a href="{%url "messageBoardDismiss" messageId=message.id %}?next={{ request.get_full_path|urlencode }}">{% endif %}
                            <button class="text-white rounded p-4 {%if user.isOrg %} bg-gray-500 {% else %} bg-purple-500 {% endif %}">
                                Skrýt
                            </button>
                        {%if not user.isOrg %}</a>{% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
{% endif %}


<h1 class="text-2xl">{{targetTeam.name}}</h1>

{% if user.isSuperUser %}
    <div class="w-full section"><h2 class="text-xl">Debugovací informace</h2></div>
    <div class="flex flex-wrap">
        {% card "Zname techy" width="full" %}
            <p class="text-left">
                {% for t in teamState.techs.getOwnedTechs %}
                    {{t.label | safe}},
                {% endfor %}
            </p>
        {% endcard %}

        {% card "Vyroby" width="full"%}
            <p class="text-left">
                {% for t in teamState.techs.getVyrobas %}
                    {{t.label | safe}},
                {% endfor %}
            </p>
        {% endcard %}

        {% card "Zásobování města" icon="fa-warehouse" width="third" color=targetTeam.color %}
            <ul class="text-left">
            {% for r, a in teamState.foodSupply.getFoodSupply.items %}
                <li>{{a}}× {{r.htmlRepr|safe}}</li>
            {% empty %}
                <span class="text-center">Nemáte žádné automatizované krmení</span>{% endfor %}
            {% for r, a in teamState.foodSupply.getLuxusSupply.items %}
                <li>{{a}}× {{r.htmlRepr|safe}}</li>
            {% empty %}
                <span class="text-center">Nemáte žádný automatizovaný luxus</span>{% endfor %}
            </ul>
        {% endcard %}

        {% card "Kolik krmení bude potřeba" icon="fa-warehouse" width="third" color=targetTeam.color %}
            Potřebujete zaplatit <b>{{foodSupplyTokens}}×</b> jídlo (přebytek {{ foodSupplySurplus }})
            <ul class="text-left">
            <li>Kvalita &mdash; Luxus</li>
            {% for roman, caste, population, unfed, foodMissing, lowQuality, qualityMissing, luxMissing, luxNeeded in foodSupplyStats %}
                <li><b>{{ roman }}</b>: <b>{{ qualityMissing }}×</b> ({{ lowQuality }}) &mdash; <b>{{ luxNeeded }}×</b> ({{ luxMissing }})</li>
            {% empty %}
                <span class="text-center">Nemáte žádné kasty. Něco je špatně</span>
            {% endfor %}
            </ul>
        {% endcard %}
    </div>
{% endif %}

<div class="w-full section"><h2 class="text-xl">Souhrnné informace</h2></div>
<div class="flex flex-wrap">
    {% card "Populace" icon="fa-users" width="third" color=targetTeam.color%}
        {{teamState.resources.getObyvatel}} / {{teamState.resources.getPopulation}}<br>
        <span class="text-sm text-gray-400">(nespecializovaných/celkem)</span>
    {% endcard %}

    {% card "Dostupná práce" icon="fa-briefcase" width="third" color=targetTeam.color %}
        {{teamState.resources.getWork}}
    {% endcard %}

    {% card "Kolo" icon="fa-calendar" width="third" color=targetTeam.color %}
        {{teamState.turn}}. kolo / {{worldState.generation}}. generace
    {% endcard %}
</div>

<div class="w-full section"><h2 class="text-xl">Ekonomika</h2></div>
<div class="flex flex-wrap">
    {% card "Právě zkoumané techologie" icon="fa-cogs" width="third" color=targetTeam.color %}
        <ul class="text-left">
            {% for r in teamState.techs.getTechsUnderResearch %}
                <li>{{r.htmlRepr | safe}}</li>
            {% empty %}
                <span class="text-center">Právě nezkoumáte žádné technologie</span>
            {% endfor %}
        </ul>
    {% endcard %}
    {% card "Dostupné produkce" icon="fa-warehouse" width="third" color=targetTeam.color %}
        <ul class="text-left">
        {% for r, a in teamState.resources.getResourcesByType.items %}
            <li>{{a}}× {{r.htmlRepr|safe}}</li>
        {% endfor %}
        </ul>
    {% endcard %}
    {% card "Materiály ve skladu" icon="fa-warehouse" width="third" color=targetTeam.color %}
        <ul class="text-left">
        {% for r, a in teamState.materials.getAll.items %}
            <li>{{a}}× {{r.htmlRepr|safe}}</li>
        {% endfor %}
        </ul>
    {% endcard %}

    {% card "Kolik krmení bude potřeba" icon="fa-utensils" width="third" color=targetTeam.color %}
        Potřebujete nakrmit {{ foodSupplySurplus }} lidí (<b>{{foodSupplyTokens}}× jídlo</b>)
        <ul class="text-left">
        <table style="width:100%">
            <tr><td>Kasta</td><td>Jídlo</td><td>Luxus</td></tr>
            {% for roman, caste, population, unfed, foodMissing, lowQuality, qualityMissing, luxMissing, luxNeeded in foodSupplyStats %}
                <tr>
                    <td>{{ roman }}</td>
                    <td>{{ qualityMissing }}</td>
                    <td>{{ luxNeeded }}</td>
                </tr>
            {% empty %}
                <span class="text-center">Nemáte žádné kasty. Něco je špatně</span>
            {% endfor %}
        </table>
        </ul>
    {% endcard %}

    {% card "Vzdálenosti budov" icon="fa-compass" width="third" color=targetTeam.color %}
        <select id="build-source" class="select my-1">
            {% for building in teamState.techs.getBuildings%}
                <option value="{{building.id}}">{{building.label}}</option>
            {% endfor %}
        </select>
        <select id="build-target" class="select my-1">
            {% for building in teamState.techs.getBuildings%}
                <option value="{{building.id}}">{{building.label}}</option>
            {% endfor %}
        </select>
        Vzálenost: <span id="build-distance">Neznámá</span>
        <script>
            var distances = [
                {% for pair, distance in teamState.distances.allBuildingDistances.items %}
                    ["{{ pair.0 }}", "{{ pair.1 }}", {{distance}}],
                {% endfor %}
            ];
            var source = document.getElementById("build-source");
            var target = document.getElementById("build-target");
            var distance = document.getElementById("build-distance");
            function update() {
                var src = source.value;
                var tgt = target.value;
                if (src == tgt) {
                    distance.innerHTML = 0;
                    return;
                }
                for (var i = 0; i != distances.length; i++ ) {
                    var item = distances[i];
                    if ( (item[0] == src && item[1] == tgt) || (item[1] == src && item[0] == tgt)) {
                        distance.innerHTML = item[2];
                        return;
                    }
                }
                distance.innerHTML = "Neznámá";
            }
            source.addEventListener("change", update);
            target.addEventListener("change", update);
            update();
        </script>
    {% endcard %}

    {% card "Vzdálenosti týmů" icon="fa-compass" width="third" color=targetTeam.color %}
        <table class="text-left">
            {% for team, distance in teamState.distances.allTeamDistances.items %}
                {% if team.id != targetTeam.id %}
                    <tr><td class="pr-5">{{team.name}}:</td>
                        <td>
                        {% if distance is None %}
                            Neznámá
                        {% else %}
                            {{distance}}
                        {% endif %}
                        </td>
                    </tr>
                {% endif %}
            {% endfor %}
        </table>
    {% endcard %}

</div>

{{ block.super }}
{% endblock %}

