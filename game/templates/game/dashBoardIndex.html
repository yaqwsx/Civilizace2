{% extends "game/dashboardBase.html" %}

{% load cards %}

{% block title %} Příběh civilizace - Dashboard {% endblock %}

{% block content %}

{% if boardMessages %}
    <h2 class="text-xl my-1">Nové zprávy</h2>

    {% for message in boardMessages %}
        <div class="w-full my-2">
            <div class="rounded shadow p-4
                    {% if message.type == message.type.normal %}
                        bg-white
                    {% elif message.type == message.type.errata %}
                        bg-blue-300
                    {% elif message.type == message.type.announcement %}
                        bg-red-300
                    {% endif %}">
                <div class="flex flex-row items-center">
                    <div class="flex-grow text-left md:w-full">
                        <p class="font-bold text-xs uppercase text-gray-600 mb-2">
                            {{message.appearDateTime}}
                            <span class="ml-4">
                                ({{message.type}})
                            </span>
                        </p>
                        <p>
                            {{ message.content | safe }}
                        </p>
                    </div>
                    <div class="flex-none text-left">
                        {%if user.team == targetTeam %}<a href="{%url "messageBoardDismiss" messageId=message.id %}?next={{ request.get_full_path|urlencode }}">{% endif %}
                            <button class="text-white rounded p-4 {%if user.team != targetTeam %} bg-gray-500 {% else %} bg-purple-500 {% endif %}">
                                Skrýt
                            </button>
                        {%if user.team == targetTeam %}</a>{% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
{% endif %}


<h1 class="text-2xl">{{targetTeam.name}}</h1>

{% if user.isSuperUser %}
    <div class="w-full section"><h2 class="text-xl">Debugovací informace</h2></div>
    <div class="flex flex-wrap">
        {% card "Zname techy" width="full" %}
            <p class="text-left">
                Tým má {{teamState.techs.getOwnedTechs | length}} technologií.
            </p>
            <p class="text-left">
                {% for t in teamState.techs.getOwnedTechs %}
                    {{t.label | safe}},
                {% endfor %}
            </p>
        {% endcard %}

        {% card "Vyroby" width="full"%}
            <p class="text-left">
                <p class="text-left">
                    Tým má {{teamState.techs.getVyrobas | length}} výrob.
                </p>
                <p class="text-left">
                {% for t in teamState.techs.getVyrobas %}
                    {{t.label | safe}},
                {% endfor %}
                </p>
            </p>
        {% endcard %}

        {% card "Pouzivane vylepseni" width="full" %}
            <p class="text-left">
                Tým má {{teamState.enhancers.getOwnedEnhancers | length}} vylepšení.
            </p>
            <p class="text-left">
                {% for e in teamState.enhancers.getOwnedEnhancers %}
                    {{e.label | safe}},
                {% endfor %}
            </p>
        {% endcard %}

        {% card "Kolik krmení bude potřeba" icon="fa-warehouse" width="third" color=targetTeam.color %}
            Potřebujete zaplatit <b>{{foodSupplyTokens}}×</b> jídlo (přebytek {{ foodSupplySurplus }})
            <ul class="text-left">
            <li>Kvalita &mdash; Luxus</li>
            {% for roman, caste, population, unfed, foodMissing, lowQuality, qualityMissing, luxMissing, luxNeeded in foodSupplyStats %}
                <li><b>{{ roman }}</b>: <b>{{ qualityMissing }}×</b> ({{ lowQuality }}) &mdash; <b>{{ luxNeeded }}×</b> ({{ luxMissing }})</li>
            {% empty %}
                <span class="text-center">Nemáte žádné kasty. Něco je špatně</span>
            {% endfor %}
            </ul>
        {% endcard %}
    </div>
{% endif %}

<div class="w-full section"><h2 class="text-xl">Souhrnné informace</h2></div>
<div class="flex flex-wrap">
    {% card "Populace" icon="fa-users" width="third" color=targetTeam.color%}
        {{teamState.resources.getObyvatel}} / {{teamState.resources.getPopulation}}<br>
        <span class="text-sm text-gray-400">(nespecializovaných/celkem)</span>
    {% endcard %}

    {% card "Dostupná práce" icon="fa-briefcase" width="third" color=targetTeam.color %}
        {{teamState.resources.getWork}}
    {% endcard %}

    {% card "Kolo" icon="fa-calendar" width="third" color=targetTeam.color %}
        {{teamState.turn}}. kolo / {{worldState.generation}}. generace
        <p>
            {% if teamState.turn == worldState.generation %}
                V této generaci jste již <b>krmili</b>.
            {% else %}
                V této generaci jste <b>nekrmili</b>.
            {% endif %}
        </p>
    {% endcard %}
</div>

<div class="w-full section"><h2 class="text-xl">Ekonomika</h2></div>
<div class="flex flex-wrap">
    {% card "Právě zkoumané techologie" icon="fa-cogs" width="third" color=targetTeam.color %}
        <ul class="text-left">
            {% for r in teamState.techs.getTechsUnderResearch %}
                <li>{{r.htmlRepr | safe}}</li>
            {% empty %}
                <span class="text-center">Právě nezkoumáte žádné technologie</span>
            {% endfor %}
        </ul>
    {% endcard %}
    {% card "Dostupné produkce" icon="fa-warehouse" width="third" color=targetTeam.color %}
        <ul class="text-left">
        {% for r, a in teamState.resources.getResourcesByType.items %}
            <li>{{a}}× {{r.htmlRepr|safe}}</li>
        {% endfor %}
        Počet míst v přístavu: {{teamState.resources.getPristav}}
        </ul>
    {% endcard %}
    {% card "Materiály ve skladu" icon="fa-warehouse" width="third" color=targetTeam.color %}
        <ul class="text-left">
        {% for r, a in teamState.materials.asMap.items %}
            <li>{{a}}× {{r.htmlRepr|safe}}</li>
        {% endfor %}
        </ul>
    {% endcard %}

    {% card "Kolik krmení bude potřeba" icon="fa-utensils" width="third" color=targetTeam.color %}
        Potřebujete nakrmit {{ foodSupplySurplus }} lidí (<b>{{foodSupplyTokens}}× jídlo</b>)
        <ul class="text-left">
        <table style="width:100%">
            <tr><td>Kasta</td><td>Jídlo</td><td>Luxus</td></tr>
            {% for roman, caste, population, unfed, foodMissing, lowQuality, qualityMissing, luxMissing, luxNeeded in foodSupplyStats %}
                <tr>
                    <td>{{ roman }}</td>
                    <td>{{ qualityMissing }}</td>
                    <td>{{ luxNeeded }}</td>
                </tr>
            {% empty %}
                <span class="text-center">Nemáte žádné kasty. Něco je špatně</span>
            {% endfor %}
        </table>
        </ul>
    {% endcard %}

    {% card "Zásobování města" icon="fa-warehouse" width="third" color=targetTeam.color %}
        <ul class="text-left">
        {% for r, a in teamState.foodSupply.getFoodSupply.items %}
            <li>{{a}}× {{r.htmlRepr|safe}}</li>
        {% empty %}
            <span class="text-center">Nemáte žádné automatizované krmení</span>{% endfor %}
        {% for r, a in teamState.foodSupply.getLuxusSupply.items %}
            <li>{{a}}× {{r.htmlRepr|safe}}</li>
        {% empty %}
            <span class="text-center">Nemáte žádný automatizovaný luxus</span>{% endfor %}
        </ul>
    {% endcard %}

    {% card "Ceny interakcí s ostrovy" icon="fa-warehouse" width="third" color=targetTeam.color %}
        <ul class="text-left">
            <li><b>Expedice</b>: 1x za kolo, zdarma</li>
            <li><b>Průzkum ostrova</b>: 1x Lod<img class="inline-block" style="width: 30px; height: 30px" src="/static/icons/ostatni-lod-4-a.svg">, 2x Jídlo III</li>
            <li><b>Kolonizace/převzetí ostrova</b>: <i>Počet vlastněných ostrovů + 1 krát:</i> 1x Loď<img class="inline-block" style="width: 30px; height: 30px" src="/static/icons/ostatni-lod-4-a.svg">, 2x Luxus II</li>
            <li><b>Dobývání ostrova</b>: <i>Počet vlastněných ostrovů + 1 krát:</i> 2x Luxus IV, 1x Loď<img class="inline-block" style="width: 30px; height: 30px" src="/static/icons/ostatni-lod-4-a.svg">
            <ul class="text-left">
                Potom 1x Dělo<img class="inline-block" style="width: 30px; height: 30px" src="/static/icons/ostatni-sila-2-a.svg"> = 2 rány (2 hody kostkou)
            </ul></li>
             <li><b>Oprava ostrova o 1 bod</b>: 1x Dělo, 1x Stavivo V</li>
        </ul>
    {% endcard %}

</div>

{{ block.super }}
{% endblock %}

